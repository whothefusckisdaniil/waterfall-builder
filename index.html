<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waterfall Builder</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåä</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>

    <button id="help-btn" class="help-btn" title="Instructions">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
    </button>

    <div class="container">
        <header class="main-header">
            <h1>Waterfall Builder</h1>
            <p>–Ø–Ω–¥–µ–∫—Å –∫–æ–Ω—Ç–æ—Ä–∞ –ø–∏–¥–∞—Ä–∞—Å–æ–≤</p>
        </header>

        <main class="main-content">
            <div class="left-panel">
                <div class="card" id="input-card">
                    <div class="card-header">
                        <h2>Input Tiers</h2>
                        <div class="header-controls">
                            <span class="row-counter" id="row-counter">0 rows</span>
                            <button class="btn btn--secondary btn--icon" id="add-row-btn" title="Add Row">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                </button>
                        </div>
                    </div>
                     <div class="card-body" id="input-choice">
                        <div class="choice-body">
                            <p>Upload a CSV with "Ad system" column or add rows manually.</p>
                            <div class="choice-buttons">
                                <label for="csv-upload-input" class="btn btn--primary">Upload CSV</label>
                                <input type="file" id="csv-upload-input" accept=".csv" class="hidden">
                                <button class="btn btn--secondary" id="manual-add-btn">Add Manually</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body hidden" id="manual-input-section">
                        <div id="rows-container"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Generated Waterfall</h2>
                    </div>
                    <div class="card-body" id="waterfall-output">
                        <p class="placeholder-text">Your generated waterfall will appear here.</p>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="card">
                    <div class="card-header">
                        <h2>USD to RUB Rate</h2>
                    </div>
                    <div class="card-body">
                        <div class="rate-input-group">
                            <input type="number" id="usd-rate" class="input-field" placeholder="e.g., 95.50">
                            <button class="btn btn--secondary btn--icon" id="refresh-rate-btn" title="Refresh Rate">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                            </button>
                        </div>
                        <div class="error-message" id="rate-error"></div>
                        <p class="status-message" id="rate-status">Updating...</p>
                    </div>
                </div>
                <div class="card">
                     <div class="card-header">
                        <h2>Actions</h2>
                    </div>
                    <div class="card-body action-buttons">
                        <button class="btn btn--primary" id="build-waterfall-btn">Build Waterfall</button>
                        <button class="btn btn--secondary" id="export-csv-btn">Export CSV</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="export-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" id="export-modal-close-btn">&times;</button>
            <h3>Export Reminder</h3>
            <p>In the exported CSV, check the Status column. If there is text - this VAST-tag is missing and must be added. If the field is empty - this tag already exists and doesn't require changes.</p>
            <div class="modal-actions">
                <button class="btn btn--secondary" id="modal-cancel-btn">Cancel</button>
                <button class="btn btn--primary" id="modal-download-btn">Download CSV</button>
            </div>
        </div>
    </div>

    <div id="help-modal" class="modal-overlay hidden">
        <div class="modal-content help-content">
            <button class="modal-close-btn" id="help-modal-close-btn">&times;</button>
            <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
            <div class="help-text">
                <p>–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å CSV-—Ñ–∞–π–ª, –æ—Ç–∫—Ä–æ–π—Ç–µ <strong>Reports ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong> –∏ —É–∫–∞–∂–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</p>
                <ul class="help-list">
                    <li>
                        <span class="emoji">üß©</span> <strong>–§–∏–ª—å—Ç—Ä—ã:</strong> –í–µ–±-—Å–∞–π—Ç/–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –°–æ–¥–µ—Ä–∂–∏—Ç | <code>–¥–æ–º–µ–Ω_pvw_waterfall</code>
                    </li>
                    <li>
                        <span class="emoji">üìä</span> <strong>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:</strong> –ü–µ—Ä–∏–æ–¥ - –≤—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–æ–π –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (–º–∏–Ω–∏–º—É–º –Ω–µ–¥–µ–ª—é) | –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –±–ª–æ–∫–∞ | –†–µ–∫–ª–∞–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
                    </li>
                    <li>
                        <span class="emoji">üìà</span> <strong>–ú–µ—Ç—Ä–∏–∫–∏:</strong> –ù–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å | CPM(v) | –†–µ–∫–ª–∞–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
                    </li>
                </ul>
                <div class="help-divider"></div>
                <p>–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–∂–∞—Ç—å <strong>Add Manually</strong> –∏ –≤–≤–µ—Å—Ç–∏ –≤—Å–µ –ø–æ—Ä–æ–≥–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Ä—É—á–Ω—É—é.</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn--primary" id="help-modal-ok-btn">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <div id="image-popup">
        <img>
    </div>

    <div id="toast-notification"></div>

    <script src="app.js"></script>
</body>
</html>
